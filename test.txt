import unittest
import os
import argparse
import test_config

def main():
    # Fetch the command line arguments
    parser = argparse.ArgumentParser(description='Run test suite with a specific date.')
    parser.add_argument('--date', type=str, default='latest', help='Date of the test data (e.g., 20231231).')
    args = parser.parse_args()

    # Validate and set the environment variable for the test date
    try:
        test_config.main(['--date', args.date])
    except ValueError as e:
        print(f"Error: {e}")
        return

    # Discover and run unit tests
    print("Running unit tests...")
    unit_tests = unittest.TestLoader().discover('tests/unit')
    unittest.TextTestRunner(verbosity=2).run(unit_tests)

    # Discover and run integration tests
    print("Running integration tests...")
    integration_tests = unittest.TestLoader().discover('tests/integration')
    unittest.TextTestRunner(verbosity=2).run(integration_tests)

if __name__ == '__main__':
    main()
